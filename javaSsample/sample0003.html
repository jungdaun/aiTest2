<!DOCTYPE html>

<html th:replace="~{layout/dhtmlxAppLayout7 :: layout(~{::script})}"  xmlns:th="http://www.thymeleaf.org">

<!-- AUIGrid 사용 시 반드시 지정 -->
<script th:src="@{/js/auigrid/includeAUIGrid.js}"></script>

<script>
//////////////////////////////////////////////////////////////////
// Form 변수
//////////////////////////////////////////////////////////////////

//main layout
var layoutMain;

// 검색 조건 form
var searchForm;

// 그룹코드 grid
var grdMain;

// 그룹코드 toolbar
var toolbar;

// 그룹코드 form
var inputForm;

// 코드 toolbar
var toolbarDtl;

// 코드 grid
var grdDtl;

// Popup 객체
var sample0001p01;



//////////////////////////////////////////////////////////////////
// 초기화 작업
//////////////////////////////////////////////////////////////////
$(function() {
	//
	// 1. 기본 layout 구성
	const layoutConfig = {
	    type: "line",
	    
	    rows: [
	    	{ id: "searchForm", height: SearchFormHeight[1] },
	    	{ id: "toolbar", height: "85px", headerHeight: 0 },
	    	{ id: "grid", height: "100%", header: "그룹코드 목록", headerHeight: "35px", html: '<div id="grdMain" style="height: 100%;"></div>' }
	    ]
	};
	
	// layout 생성
    layoutMain = new dhx.Layout("layoutObj", layoutConfig);
	
	
	//
    // 2. Form controls 생성 (검색조건)
    searchForm = new dhx.Form(null, {
        rows: [
            {
                cols: [
                	FormUtil.getInputConfig(
                		{ width: "300px", label: "그룹코드", name: "GRP_CD", labelWidth: "300px" }
                	),
                	FormUtil.getInputConfig(
                		{ width: "300px", label: "그룹코드명", name: "GRP_CD_NM", labelWidth: "300px" }
                	),
                	FormUtil.getSelectConfig(
                		{ width: "300px", label: "사용여부", name: "USE_YN", labelWidth: "300px"}
                	  , [ { content: "전체", value: "" }, { content: "사용", value: "Y" }, { content:"미사용", value:"N" } ]
                	)
                ]
            }
        ]
    });
	
    layoutMain.getCell("searchForm").attach(searchForm);
    
    
    //
    // 3. Grid 생성 (그룹코드 목록)
    let mainProps = {
    	  editable: true
		, showStateColumn : true
		, enableFilter: true
    };

    mainColumnLayout = [
          AUIGridUtil.getColumnConfig({
        	  dataField: "GRP_CD", headerText: "그룹코드", width: 160, editable: false, headerTooltip: "신규가 아닌 행은 코드 변경 불가능"
       	  })
        , AUIGridUtil.getColumnConfig({ dataField: "GRP_CD_NM", headerText: "그룹코드명", showFilter: true })
        , AUIGridUtil.getDropDownColumnConfig({
        	  dataField: "ADD_INFO_YN", headerText: "추가정보", width: 100
        	, list: [ 
        		{value: "Y", content: "추가정보존재"}, {value: "N", content: "추가정보없음"}
        	  ]
          })
        , AUIGridUtil.getNumericColumnConfig({ dataField: "PRICE", headerText: "가격" })
        , AUIGridUtil.getCalendarColumnConfig({ 
        	dataField: "START_DT", headerText: "시작일자", width: 120
          })
        , AUIGridUtil.getColumnConfig({ dataField: "REMARK", headerText: "비고" })
		, AUIGridUtil.getCheckboxColumnConfig({dataField: "USE_YN", headerText: "사용여부", width: 120 })
    ];
    
    grdMain = AUIGridUtil.create( "grdMain", mainColumnLayout, mainProps );
    
	
	//
    // 4. Toolbar 버튼 생성
	let toolBar = FormUtil.createToolbar(
		null, null, 
		[
		{ id: "add", value: "행추가" },
		{ type: "separator" },
		{ id: "del", value: "행삭제" },
		],
		{
			click: function(id, e) {
		        switch(id) {
					case "add":
					    fn_addRow(grdMain);
					    break;
					    
					case "del":
					    fn_delRow(grdMain);
					    break;
					    
					case "save":
					    fn_saveGrid();
						
					    break;
					default:
					    break;
	        	}    			
			}
		}
	);
	
	layoutMain.getCell("toolbar").attach(toolBar);

	    
	
	//
    // 5. event 처리

	// 그룹코드 목록 그리드에 selectionChange 이벤트 생성
	//AUIGridUtil.setSelectionChange(grdMain, fn_selectionChangeCallback);
	
	// 그룹코드 목록 그리드 Cell 클릭 Event
 	//AUIGridUtil.setCellClick(grdMain, fn_cellClickCallback);
	
	// 그룹코드 목록 그리드 Cell 더블클릭 Event
 	AUIGridUtil.setCellDoubleClick(grdMain, fn_cellDoubleClickCallback);


    
	//
	// 6. focus 처리
    FormUtil.setFocus(searchForm, "GRP_CD");
    
    
	//
	// 7. 최종 form control 공통 기능 초기화
    FormUtil.initForms(searchForm);
	
	
	//
	// 좌측 Menu tree가 아닌 gfn_openMenu()를 호출하여 load될 때 caller에서 넘겨주는 parameter 받기
	// ex> sample0001.html 참조
	//     gfn_openMenu("SMPL0003", {PARAM_VAL1: "구분"});
	let param = gfn_getMDIParameter();
	
	if ( gfn_isNotNull(param) ) {
		FormUtil.setFormValue(searchForm, "GRP_CD_NM", param.PARAM_VAL1);
	}
});





//////////////////////////////////////////////////////////////////
// 공통 button
//////////////////////////////////////////////////////////////////

/**
 * 조회 button click
 */
function fn_search() {
	if ( fn_isModified() ) {
		gfn_confirm("변경된 데이터가 존재합니다. 초기화하시겠습니까?", null, function(result) {
			if ( result ) {
				fn_searchList();
			}
		});
		
	} else {
		fn_searchList();
	}
}


/**
 * 저장
 */
function fn_save() {
    gfn_ajaxSaveAUIGrid({
        url: "/sample/sample0003/saveSample0003.do",
        gridName: grdMain,
        postType: "SAVE",
        type: "POST",
        success: function() {
        	fn_search(); 
        }
    });
}


/**
 * 데이터 변경 여부 반환
 */
function fn_isModified() {
	return AUIGridUtil.isModified(grdMain);
}





//////////////////////////////////////////////////////////////////
// 개발자 정의 function
//////////////////////////////////////////////////////////////////

function fn_searchList() {
	var postParam = FormUtil.getFormValues(searchForm);
	
    gfn_ajaxGetAUIGrid({
		 gridName    : grdMain
       , postParam   : postParam
       , type        : "POST"
       , url         : "/sample/sample0003/selectSample0003.do"
       , success     : function(responseData) {
            if ( gfn_isNotNull(responseData.result) ) {
                // 첫 행 클릭
                AUIGridUtil.setSelectionByIndex(grdMain, 0);
            }
         }
       , fail: function() { }
       , complete: function(data) { }
    });
}


/**
 * Comments : 그리드 row를 추가한다.
 * @param {object} gridObj - AUIGrid 객체
 * @return
 */
function fn_addRow(gridObj) {
    var rowIndex = AUIGrid.getSelectedIndex(gridObj)[0];
    
    if(gridObj == grdDtl) {
    	AUIGridUtil.addRow(gridObj, null, "last", "MCD_CD");	// addRow 후 MCD_CD 셀 편집
    } else {
    	AUIGridUtil.addRow(gridObj);	// addRow
    }
    
    //AUIGridUtil.addRow(grdMain, null, rowIndex+1);	// 선택 행 다음 addRow (selectionDown)
    // rowIndex : 그리드에 추가할 rowIndex or "first" : 첫 행, "last" : 최하단, "selectionUp" : 선택행 위, "selectionDown" : 선택행 아래
}

/**
 * Comments : 그리드 row를 삭제한다.
 * @param {object} gridObj - AUIGrid 객체
 * @return
 */
function fn_delRow(gridObj) {
    var rowIndex = AUIGrid.getSelectedIndex(gridObj)[0];
    if( rowIndex == null || rowIndex == 'undefined' ) rowIndex = 0;

    AUIGridUtil.deleteRow(gridObj, rowIndex);
}




 
//////////////////////////////////////////////////////////////////
//event 처리
//////////////////////////////////////////////////////////////////

/**
 * Comments : 그룹코드 목록 그리드 selectionChange 이벤트 발생 시 해당 row의 값을 그룹코드 정보 Form 에 설정한 후 코드 목록을 조회한다. 
 * @param {object} item - 선택된 row item
 * @return
 */
function fn_selectionChangeCallback(item) {	
	 fn_setInputFormDtl(item);
}
 
function fn_cellClickCallback(event) {	
	alert("셀 클릭:::"+event);
}


var sample0001p01;

function fn_cellDoubleClickCallback(event) {	
	if( event.dataField == "GRP_CD" ) {
		let config = {
			  id: "smpl0001p01"
			, width: 1024
			, height: 300
			, title: "카테고리 선택"
			, callback: "smpl0001p01_popupCallback"
			, resizable: true
		};
		
		let param = { };
		
		sample0001p01 = gfn_openPopup("/sample/sample0001_P01.do", config, param);
	}
}





//////////////////////////////////////////////////////////////////
// callback 처리
//////////////////////////////////////////////////////////////////

/**
 * Popup에 대한 callback 함수
 */
function smpl0001p01_popupCallback(action, data) {
	if ( action == "CANCEL" ) {
		sample0001p01.close();
	}
}

</script>
</html>